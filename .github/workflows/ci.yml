name: Continuous Integration

on:
  workflow_dispatch:
  push:

jobs:

  main_stable:
    name: Rust stable
    uses: ./.github/workflows/_build.yml
    with:
      rust_toolchain: stable
      rust_features: --features "full"
      with_rustfmt: true

  main_1_56_1:
    name: Rust 1.56.1
    uses: ./.github/workflows/_build.yml
    with:
      rust_toolchain: 1.56.1
      rust_features: --features "full"
      with_clippy: true
      pre_build_script: ./scripts/msrv_pin_dependencies.sh

  main_nightly:
    name: Rust nightly
    uses: ./.github/workflows/_build.yml
    with:
      rust_toolchain: nightly
      rust_features: --all-features

  cross_stable_i686:
    name: Rust stable i686-unknown-linux-gnu
    uses: ./.github/workflows/_cross_build.yml
    with:
      target: i686-unknown-linux-gnu
      rust_toolchain: stable
      rust_features: --features "full"

  cross_stable_aarch64:
    name: Rust stable aarch64-unknown-linux-gnu
    uses: ./.github/workflows/_cross_build.yml
    with:
      target: aarch64-unknown-linux-gnu
      rust_toolchain: stable
      rust_features: --features "full"

  cross_1_65_0_i686:
    name: Rust 1.65.0 i686-unknown-linux-gnu
    uses: ./.github/workflows/_cross_build.yml
    with:
      target: i686-unknown-linux-gnu
      rust_toolchain: 1.65.0
      rust_features: --features "full"

  cross_1_65_0_aarch64:
    name: Rust 1.65.0 aarch64-unknown-linux-gnu
    uses: ./.github/workflows/_cross_build.yml
    with:
      target: aarch64-unknown-linux-gnu
      rust_toolchain: 1.65.0
      rust_features: --features "full"

